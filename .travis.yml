language: c
sudo: required
dist: trusty
compiler:
   - gcc
   - clang
before_install:
   - openssl aes-256-cbc -K $encrypted_18d5d806b7a8_key -iv $encrypted_18d5d806b7a8_iv -in .travis/deploy_key.pem.enc -out .travis/deploy_key.pem -d
   - sudo apt-get update -qq
   - sudo apt-get install -y libsdl2-2.0-0 libsdl2-image-2.0-0 libgl1-mesa-dri libxml2 libfreetype6 libpng12-0 libopenal1 libvorbis0a libzip2 build-essential automake libsdl2-dev libsdl2-image-dev libgl1-mesa-dev libxml2-dev libfreetype6-dev libpng12-dev libopenal-dev libvorbis-dev binutils-dev libzip-dev libiberty-dev luajit luarocks
   - sudo luarocks install ldoc
script:
  - "./autogen.sh && ./configure && make"
  - cd docs && ./luadoc.sh && cd ..
deploy:
  provider: script
  script: .travis/deploy.sh
  skip_cleanup: true
  on:
    condition: "$CC = gcc" # Don't want to run twice
    branch: travis # Should be removed when for real use; master is default
